filter {
  if [type] == "haproxy-access" {
    grok {
      match => {
        "message" => [
          "%{HAPROXYHTTP}"
        ]
      }
    }

    date {
      match => [ "accept_date", "dd/MMM/yyyy:HH:mm:ss.SSS" ]
      target => "@timestamp"
      add_tag => [ "timestamp_from_log" ]
    }

    useragent {
      source => "request_header_user_agent"
      target => "user_agent"
      regexes => "/opt/logstash/regexes/regexes_custom.yaml"
    }

    if [client_ip] {
      mutate {
        add_field => { "clientip" => "%{client_ip}" }
      }
    }
  }
}
